<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - buffergeometry - particles</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="styles/main.css">
</head>
<body>

<div id="container"></div>
<div id="info"><a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> webgl - buffergeometry - particles</div>

<script type="module">

    import * as THREE from './lib/threejs/three.module.js';

    import Stats from './lib/threejs/stats.module.js';

    import * as ca_x from './data/Ca_Concentration_x2.js';
    import * as ca_y from './data/Ca_Concentration_y2.js';
    import * as ca_z from './data/Ca_Concentration_z2.js';
    import * as ca_t from './data/Ca_Concentration_t2.js';

    const pos_x = ca_x.default;
    const pos_y = ca_y.default;
    const pos_z = ca_z.default;

    const val_t = ca_t.default;

    let container, stats;

    let camera, scene, renderer;

    let points;

    init();
    animate();

    function init() {

        container = document.getElementById( 'container' );

        camera = new THREE.PerspectiveCamera( 27, window.innerWidth / window.innerHeight, 5, 3500 );
        camera.position.z = 2750;

        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0x050505 );
        scene.fog = new THREE.Fog( 0x050505, 2000, 3500 );

        const particles = 125000;

        const geometry = new THREE.BufferGeometry();

        const positions = [];
        const colors = [];

        const color = new THREE.Color();
        const low_color = new THREE.Color(0xffffe6);
        const high_color = new THREE.Color(0xcc0000);

        // const n = 200, n2 = n / 2; // particles spread in the cube



        for ( let i = 0; i < particles; i ++ ) {

            // positions

            const x = (pos_x[i]-25)*20;
            const y = (pos_y[i]-25)*20;
            const z = (pos_z[i]-25)*20;

            positions.push( x, y, z );

            // colors

            // const vx = ( x / n ) + 0.5;
            // const vy = ( y / n ) + 0.5;
            // const vz = ( z / n ) + 0.5;

            color.lerpColors(low_color,high_color, val_t[i]);


            colors.push( color.r, color.g, color.b );

        }

        geometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );
        geometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );

        geometry.computeBoundingSphere();


        const material = new THREE.PointsMaterial( { size: 30, vertexColors: true } );

        points = new THREE.Points( geometry, material );
        scene.add( points );


        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );

        container.appendChild( renderer.domElement );


        stats = new Stats();
        container.appendChild( stats.dom );


        window.addEventListener( 'resize', onWindowResize );

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }


    function animate() {

        requestAnimationFrame( animate );

        render();
        stats.update();

    }

    function render() {

        const time = Date.now() * 0.0001;

        points.rotation.x = time * 0.25;
        points.rotation.y = time * 0.5;

        renderer.render( scene, camera );

    }

</script>

</body>
</html>